<!DOCTYPE html>
<html lang="en">
  <%- include("../header"); %>
  <!-- 다른파일 인클루드 -->

  <body>
    <%- include("../menu"); %>

    <div class="wrapper-editor">

      <div class="block my-4">
        <div class="d-flex justify-content-center">
          <h5><%= user.name %>님의 마지막 운동 날짜 : <%= lasttrain.date %></h5>
        </div>
      </div>

      <!-- 일지 작성하기 -->
      <div class="row d-flex justify-content-center modalWrapper">
        <div class="modal fade addNewInputs" id="modalAdd15" tabindex="-1" role="dialog" aria-labelledby="modalAdd15"
          aria-hidden="true">
          <div class="modal-dialog" role="document">
            <div class="modal-content">
              <div class="modal-header text-center">
                <h4 class="modal-title w-100 font-weight-bold text-default ml-5">작성하기</h4>
                <button type="button" class="close text-default" data-dismiss="modal" aria-label="Close">
                  <span aria-hidden="true">&times;</span>
                </button>
              </div>

              <form id="createForm">
              <div class="modal-body mx-3 modal-add-inputs">

                <div class="md-form">
                  <input type="date" id="date" class="form-control" placeholder="Select Date">
                  <label data-error="wrong" data-success="right" for="date"></label>
                </div>

                <div class="md-form">
                  <input
                    id="name"
                    type="text"
                    length="10"
                    class="form-control"
                    required
                  />
                  <label for="name">종류</label>
                </div>
                <div class="md-form">
                  <input
                    id="nums"
                    type="number"
                    length="10"
                    class="form-control"
                    required
                  />
                  <label for="nums">횟수</label>
                </div>
                <div class="md-form">
                  <input
                    id="sets"
                    type="number"
                    length="10"
                    class="form-control"
                    required
                  />
                  <label for="sets">세트</label>
                </div>
                <div class="md-form">
                  <input
                    id="weight"
                    type="number"
                    length="10"
                    class="form-control"
                  />
                  <label for="weight">중량</label>
                </div>
                <div class="md-form mb-5">
                  <input
                    id="bodyweight"
                    type="number" step=0.01
                    length="10"
                    class="form-control"
                  />
                  <label for="bodyweight">체중</label>
                </div>


              </div>
              <div class="modal-footer d-flex justify-content-center buttonAddFormWrapper">
                <button type="submit" class="btn btn-outline-default btn-block buttonAdd">작성
                  <i class="far fa-paper-plane ml-1"></i>
                </button>
              </div>
              </form>
            </div>
          </div>
        </div>
        <!-- 일지 작성하기 END -->


        <div class="text-center">
          <a href="" class="btn btn-default btn-rounded btn-sm" data-toggle="modal" data-target="#modalAdd15">추가<i
              class="fas fa-plus-square ml-1"></i></a>
        </div>
        

        <!-- 일지 수정하기 -->
        <div class="modal fade modalEditClass" id="modalEdit15" tabindex="-1" role="dialog" aria-hidden="true">
          <div class="modal-dialog" role="document">
            <div class="modal-content">
              <div class="modal-header text-center">
                <h4 class="modal-title w-100 font-weight-bold text-info ml-5">수정하기</h4>
                <button type="button" class="close text-info" data-dismiss="modal" aria-label="Close">
                  <span aria-hidden="true">&times;</span>
                </button>
              </div>

              <form id="updateForm">
                <div class="modal-body mx-3 modal-add-inputs">
  
                  <div class="md-form">
                    <input type="date" id="dateEdit" class="form-control" placeholder="Select Date">
                    <label data-error="wrong" data-success="right" for="date"></label>
                  </div>
  
                  <div class="md-form">
                    <input
                      id="nameEdit"
                      type="text"
                      length="10"
                      class="form-control"
                      required
                    />
                    <label for="nameEdit"></label>
                  </div>
                  <div class="md-form">
                    <input
                      id="numsEdit"
                      type="number"
                      length="10"
                      class="form-control"
                      required
                    />
                    <label for="numsEdit"></label>
                  </div>
                  <div class="md-form">
                    <input
                      id="setsEdit"
                      type="number"
                      length="10"
                      class="form-control"
                      required
                    />
                    <label for="setsEdit"></label>
                  </div>
                  <div class="md-form">
                    <input
                      id="weightEdit"
                      type="number"
                      length="10"
                      class="form-control"
                    />
                    <label for="weightEdit"></label>
                  </div>
                  <div class="md-form mb-5">
                    <input
                      id="bodyweightEdit"
                      type="number" step=0.01
                      length="10"
                      class="form-control"
                    />
                    <label for="bodyweightEdit"></label>
                  </div>
                </div>

              <div class="modal-footer d-flex justify-content-center editInsideWrapper">
                <button type="submit" class="btn btn-outline-info btn-block editInside">수정
                  <i class="far fa-paper-plane ml-1"></i>
                </button>
              </div>
              </form>
            </div>
          </div>
        </div>
        <!-- 일지 수정하기 END -->

        <div class="text-center buttonEditWrapper">
          <button id="buttonEdit" class="btn btn-info btn-rounded btn-sm buttonEdit" data-toggle="modal" data-target="#modalEdit15"
            >수정<i class="fas fa-pen-square ml-1"></i></a>
        </div>

        <!-- 일지 삭제하기 -->
        <div class="modal fade" id="modalDelete15" tabindex="-1" role="dialog" aria-labelledby="modalDelete15"
          aria-hidden="true">
          <div class="modal-dialog" role="document">
            <div class="modal-content">
              <div class="modal-header text-center">
                <h4 class="modal-title w-100 font-weight-bold ml-5 text-danger">삭제하기</h4>
                <button type="button" class="close text-danger" data-dismiss="modal" aria-label="Close">
                  <span aria-hidden="true">&times;</span>
                </button>
              </div>
              <div class="modal-body mx-3">
                <p class="text-center h4">정말로 삭제하시겠습니까?
                </p>
              </div>
              <div class="modal-footer d-flex justify-content-center deleteButtonsWrapper">
                <button type="button" class="btn btn-outline-danger btnYesClass" id="btnYes15">네
                  <i class="far fa-paper-plane ml-1"></i>
                </button>
                <button type="button" class="btn btn-outline-primary btnNoClass" id="btnNo15" data-dismiss="modal">아니요
                  <i class="far fa-paper-plane ml-1"></i>
                </button>
              </div>
            </div>
          </div>
        </div>
        <!-- 일지 삭제하기 END -->
        <div class="text-center">
          <button class="btn btn-danger btn-sm btn-rounded buttonDelete" data-toggle="modal" data-target="#modalDelete15">삭제<i class="fas fa-times ml-1"></i></a>
        </div>
      </div>


      <table id="dt-less-columns" class="table table-striped table-bordered" cellspacing="0" width="100%">
        <thead>
          <tr>
            <th class="th-sm">날짜
            </th>
            <th class="th-sm">종류
            </th>
            <th class="th-sm">횟수
            </th>
            <th class="th-sm">세트
            </th>
            <th class="th-sm">중량(kg)
            </th>
            <th class="th-sm">체중(kg)
            </th>
          </tr>
        </thead>
        <tbody id="selectable">
          <% result.forEach(dailytrain=> { %>
            <tr id="<%=dailytrain._id%>">
              <th id="dateDis" scope="row"><%- dailytrain.date %></th>
              <td id="nameDis"><%- dailytrain.name %></td>
              <td id="numsDis"><%- dailytrain.nums %></td>
              <td id="setsDis"><%- dailytrain.sets %></td>
              <td id="weightDis"><%- dailytrain.weight %></td>
              <td id="bodyweightDis"><%- dailytrain.bodyweight %></td>
            </tr>
            <% }); %>
        <tfoot>
          <tr>
            <th>날짜
            </th>
            <th>종류
            </th>
            <th>횟수
            </th>
            <th>세트
            </th>
            <th>중량(kg)
            </th>
            <th>체중(kg)
            </th>
          </tr>
        </tfoot>
      </table>
    </div>

    <%- include("../footer"); %>
    <%- include("chart"); %>
    
    <script>
      $(function () {
        $("#buttonEdit").on("click", () => {
          const datedefault = $("#selectable .ui-selected #dateDis").text();
          const namedefault = $("#selectable .ui-selected #nameDis").text();
          const numsdefault = $("#selectable .ui-selected #numsDis").text();
          const setsdefault = $("#selectable .ui-selected #setsDis").text();
          const weightdefault = $("#selectable .ui-selected #weightDis").text();
          const bodyweightdefault = $("#selectable .ui-selected #bodyweightDis").text();
          $("#dateEdit").val(datedefault);
          $("#nameEdit").val(namedefault);
          $("#numsEdit").val(numsdefault);
          $("#setsEdit").val(setsdefault);
          $("#weightEdit").val(weightdefault);
          $("#bodyweightEdit").val(bodyweightdefault);
        });

        $("#selectable").selectable();

        
        // 수정하기
        $("#updateForm").submit((event) => {
          event.preventDefault(); // 새로고침 되는걸 막아줌
          // 등록
          const name = $("#nameEdit").val();
          const nums = $("#numsEdit").val();
          const sets = $("#setsEdit").val();
          const date = $("#dateEdit").val();
          const weight = $("#weightEdit").val();
          const bodyweight = $("#bodyweightEdit").val();
          const id = $("#selectable .ui-selected").attr('id');

          if(id) {
          $.ajax({
            url: "/api/dailytrain/"+ id,
            type: "PUT",
            data: {name, nums, sets, date, weight, bodyweight },
          })
            .done(() => {
              location.href = "/api/dailytrain";
            })
            .fail((request, status, error) => {
              alert(request.responseText);
            });
          } else {
            alert("수정할 행을 선택하세요!");
          }
        });
        // 수정하기 END


        // 삭제하기
        $("#btnYes15").on("click", () => {
          const id = $("#selectable .ui-selected").attr('id');
          if (id) {
          // 삭제
            $.ajax({
            url: "/api/dailytrain/"+id,
            type: "DELETE",
          })
            .done(() => {
              location.href = "/api/dailytrain/";
            })
            .fail((request, status, error) => {
                lert(request.responseText);
            });
          } else {
            alert("삭제할 행을 선택하세요!");
          }
        });
        // 삭제하기 END


        // 추가하기
        $("#createForm").submit((event) => {
          event.preventDefault(); // 새로고침 되는걸 막아줌
          // 등록
          const name = $("#name").val();
          const nums = $("#nums").val();
          const sets = $("#sets").val();
          const date = $("#date").val();
          const weight = $("#weight").val();
          const bodyweight = $("#bodyweight").val();

          $.ajax({
            url: "/api/dailytrain",
            type: "POST",
            data: {name, nums, sets, date, weight, bodyweight },
          })
            .done(() => {
              location.href = "/api/dailytrain";
            })
            .fail((request, status, error) => {
              alert(request.responseText);
            });
        });
        // 추가하기 END


      });
    </script>
  </body>
</html>
